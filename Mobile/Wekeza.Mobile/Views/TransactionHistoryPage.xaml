<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Wekeza.Mobile.Views.TransactionHistoryPage"
             xmlns:viewmodel="clr-namespace:Wekeza.Mobile.ViewModels"
             x:DataType="viewmodel:TransactionHistoryViewModel"
             Title="Transaction History"
             BackgroundColor="#F5F5F5">

    <RefreshView IsRefreshing="{Binding IsRefreshing}" Command="{Binding RefreshTransactionsCommand}">
        <CollectionView ItemsSource="{Binding Transactions}"
                        SelectionMode="None">
            <CollectionView.EmptyView>
                <VerticalStackLayout Padding="20" Spacing="10" VerticalOptions="Center">
                    <Label Text="No transactions found"
                           FontSize="18"
                           TextColor="#666666"
                           HorizontalOptions="Center"/>
                    <Label Text="Your transaction history will appear here"
                           FontSize="14"
                           TextColor="#999999"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Margin="15,10,15,0" 
                           Padding="15"
                           BackgroundColor="White"
                           CornerRadius="10"
                           HasShadow="True">
                        <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto,Auto">
                            
                            <!-- Transaction Icon -->
                            <Frame Grid.Row="0" Grid.Column="0" Grid.RowSpan="2"
                                   WidthRequest="50"
                                   HeightRequest="50"
                                   Padding="0"
                                   CornerRadius="25"
                                   BackgroundColor="#E8F5E9"
                                   HasShadow="False"
                                   VerticalOptions="Center"
                                   Margin="0,0,15,0">
                                <Label Text="ðŸ’³"
                                       FontSize="24"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </Frame>

                            <!-- Transaction Details -->
                            <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="5">
                                <Label Text="{Binding Type}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="#333333"/>
                                
                                <Label Text="{Binding Description}"
                                       FontSize="12"
                                       TextColor="#666666"
                                       MaxLines="1"
                                       LineBreakMode="TailTruncation"/>
                            </VerticalStackLayout>

                            <!-- Amount -->
                            <Label Grid.Row="0" Grid.Column="2"
                                   Text="{Binding Amount, StringFormat='KES {0:N2}'}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#2E7D32"
                                   VerticalOptions="Start"/>

                            <!-- Date and Status -->
                            <HorizontalStackLayout Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" Spacing="10" Margin="0,5,0,0">
                                <Label Text="{Binding Date, StringFormat='{0:MMM dd, yyyy HH:mm}'}"
                                       FontSize="11"
                                       TextColor="#999999"/>
                                
                                <Frame Padding="5,2"
                                       CornerRadius="5"
                                       BackgroundColor="#E8F5E9"
                                       HasShadow="False">
                                    <Label Text="{Binding Status}"
                                           FontSize="10"
                                           TextColor="#2E7D32"/>
                                </Frame>
                            </HorizontalStackLayout>

                            <!-- Reference Number -->
                            <Label Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2"
                                   Text="{Binding ReferenceNumber, StringFormat='Ref: {0}'}"
                                   FontSize="10"
                                   TextColor="#999999"
                                   Margin="0,5,0,0"/>

                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

            <CollectionView.Footer>
                <VerticalStackLayout Padding="20">
                    <ActivityIndicator IsRunning="{Binding IsLoading}"
                                      IsVisible="{Binding IsLoading}"
                                      Color="#2E7D32"
                                      HorizontalOptions="Center"/>
                    
                    <Button Text="Load More"
                            Command="{Binding LoadMoreTransactionsCommand}"
                            BackgroundColor="#2E7D32"
                            TextColor="White"
                            CornerRadius="10"
                            IsVisible="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"
                            Margin="0,10,0,20"/>
                </VerticalStackLayout>
            </CollectionView.Footer>

        </CollectionView>
    </RefreshView>

</ContentPage>
